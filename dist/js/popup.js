if("?foo"!==location.search)throw location.search="?foo",new Error;!function(a){var b=a.Pinput||{},c=b.Popup||{};c.Message={isBookmarked:"This URL is already bookmarked.",isNotAuthenticated:"API Token is not authenticated.",succeed:"Bookmarked successfully!",failed:"Bookmark is failed..."},$(function(){var a=$("#js-form"),d=$("#js-url"),e=$("#js-title"),f=$("#js-tags"),g=$("#js-description"),h=$("#js-private"),i=$("#js-readlater"),j=$("#js-bookmark"),k=$("#js-alert"),l=chrome.storage.sync;chrome.runtime.sendMessage({},function(m){d.val(m.url),e.val(m.title),f.focus(),l.get([b.StorageKey.APIToken,b.StorageKey.isAuthenticated],function(l){b.authToken=l[b.StorageKey.APIToken],b.isAuthenticated=!!l[b.StorageKey.isAuthenticated],b.isAuthenticated?(b.API.getPost(m.url).done(function(a){0!==a.posts.length?(f.val(a.posts.shift().tags),k.removeClass("alert-info alert-success alert-danger"),k.html(c.Message.isBookmarked).addClass("alert-warning")):b.API.suggestPost(m.url).done(function(a){a.forEach(function(a){Array.isArray(a.popular)&&f.val(a.popular.join(" "))})})}).always(function(){b.API.getTags().done(function(a){var c=Object.keys(a);f.bind("keydown",function(a){a.keyCode===$.ui.keyCode.TAB&&$(this).data("ui-autocomplete").menu.active&&a.preventDefault()}).autocomplete({minLength:0,max:5,autoFocus:!0,source:function(a,d){d($.ui.autocomplete.filter(c,b.Util.extractLast(a.term)).slice(0,5))},focus:function(){return!1},select:function(a,c){var d=b.Util.split(this.value);return d.pop(),d.push(c.item.value),d.push(""),this.value=d.join(" "),!1}})})}),a.on("submit",function(a){a.preventDefault(),b.API.addPost({url:d.val(),description:e.val(),extended:g.val(),tags:f.val(),shared:h.prop("checked")?"no":"yes",toread:i.prop("checked")?"yes":"no"}).done(function(a){"done"!==a.result_code?(k.removeClass("alert-info alert-warning alert-success"),k.html(a.result_code).addClass("alert-danger")):(k.removeClass("alert-info alert-warning alert-danger"),k.html(c.Message.succeed).addClass("alert-success"),window.setTimeout(function(){window.close()},500))}).fail(function(a){k.removeClass("alert-info alert-warning alert-success"),k.html(a).addClass("alert-danger")})}),j.on("click",function(a){a.preventDefault(),b.API.addPost({url:d.val(),description:e.val(),extended:g.val(),tags:f.val(),shared:h.prop("checked")?"no":"yes",toread:i.prop("checked")?"yes":"no"}).done(function(a){"done"!==a.result_code?(k.removeClass("alert-info alert-warning alert-success"),k.html(a.result_code).addClass("alert-danger")):(k.removeClass("alert-info alert-warning alert-danger"),k.html(c.Message.succeed).addClass("alert-success"),window.setTimeout(function(){window.close()},500))}).fail(function(a){k.removeClass("alert-info alert-warning alert-success"),k.html(a).addClass("alert-danger")})})):(k.removeClass("alert-info alert-warning alert-success"),k.html(c.Message.isNotAuthenticated).addClass("alert-danger"),j.attr("disabled","disabled"))})})})}(this);