if("?foo"!==location.search)throw location.search="?foo",new Error;!function(a){var b=a.Pinput||{},c=b.Popup||{};c.Message={isBookmarked:"This URL is already bookmarked.",isNotAuthenticated:"API Token is not authenticated.",bookmarkedSuccessfully:"Bookmarked successfully!",updatedSuccessfully:"Updated successfully!",deletedSuccessfully:"Deleted successfully!",failedToBookmark:"Failed to bookmark...",failedToUpdate:"Failed to update...",failedToDelete:"Failed to delete..."},$(function(){var a=$("#js-form"),d=$("#js-url"),e=$("#js-title"),f=$("#js-tags"),g=$("#js-description"),h=$("#js-private"),i=$("#js-readlater"),j=$("#js-bookmark"),k=$("#js-bookmark-dropdown"),l=$("#js-delete"),m=$("#js-alert"),n=chrome.storage.sync;chrome.runtime.sendMessage({},function(o){d.val(o.url),e.val(o.title),f.focus();var p=[b.StorageKey.authToken,b.StorageKey.isAuthenticated,b.StorageKey.useTagSuggestion];n.get(p,function(n){b.authToken=n[b.StorageKey.authToken],b.isAuthenticated=!!n[b.StorageKey.isAuthenticated],b.useTagSuggestion=!!n[b.StorageKey.useTagSuggestion],b.isAuthenticated?(b.API.getPost(o.url).done(function(a){0!==a.posts.length?(f.val(a.posts.shift().tags),j.removeClass("btn-primary").addClass("btn-warning").text("Update bookmark"),k.removeClass("btn-primary").addClass("btn-warning"),m.removeClass("alert-info alert-success alert-danger"),m.html(c.Message.isBookmarked).addClass("alert-warning"),c.Message.bookmarkedSuccessfully=c.Message.updatedSuccessfully,c.Message.failedToBookmark=c.Message.failedToUpdate):b.useTagSuggestion&&b.API.suggestPost(o.url).done(function(a){a.forEach(function(a){Array.isArray(a.popular)&&f.val(a.popular.join(" "))})})}).always(function(){b.API.getTags().done(function(a){var c=Object.keys(a);f.on("keydown",function(a){a.keyCode===$.ui.keyCode.TAB&&$(this).data("ui-autocomplete").menu.active&&a.preventDefault()}).autocomplete({minLength:0,max:5,autoFocus:!0,source:function(a,d){d($.ui.autocomplete.filter(c,b.Util.extractLast(a.term)).slice(0,5))},focus:function(){return!1},select:function(a,c){var d=b.Util.split(this.value);return d.pop(),d.push(c.item.value),d.push(""),this.value=d.join(" "),!1}})})}),a.on("submit",function(a){a.preventDefault(),b.API.addPost(d.val(),e.val(),g.val(),f.val(),h.prop("checked")?"no":"yes",i.prop("checked")?"yes":"no").done(function(a){"done"!==a.result_code?(m.removeClass("alert-info alert-warning alert-success"),m.html(c.Message.failedToBookmark).addClass("alert-danger")):(m.removeClass("alert-info alert-warning alert-danger"),m.html(c.Message.bookmarkedSuccessfully).addClass("alert-success"),window.setTimeout(function(){window.close()},500))}).fail(function(a){m.removeClass("alert-info alert-warning alert-success"),m.html(a).addClass("alert-danger")})}),j.on("click",function(a){a.preventDefault(),b.API.addPost(d.val(),e.val(),g.val(),f.val(),h.prop("checked")?"no":"yes",i.prop("checked")?"yes":"no").done(function(a){"done"!==a.result_code?(m.removeClass("alert-info alert-warning alert-success"),m.html(c.Message.failedToBookmark).addClass("alert-danger")):(m.removeClass("alert-info alert-warning alert-danger"),m.html(c.Message.bookmarkedSuccessfully).addClass("alert-success"),window.setTimeout(function(){window.close()},500))}).fail(function(a){m.removeClass("alert-info alert-warning alert-success"),m.html(a).addClass("alert-danger")})}),l.on("click",function(a){a.preventDefault(),b.API.deletePost(d.val()).done(function(a){"done"!==a.result_code?(m.removeClass("alert-info alert-warning alert-success"),m.html(c.Message.failedToDelete).addClass("alert-danger")):(m.removeClass("alert-info alert-warning alert-danger"),m.html(c.Message.deletedSuccessfully).addClass("alert-success"),window.setTimeout(function(){window.close()},500))}).fail(function(a){m.removeClass("alert-info alert-warning alert-success"),m.html(a).addClass("alert-danger")})})):(m.removeClass("alert-info alert-warning alert-success"),m.html(c.Message.isNotAuthenticated).addClass("alert-danger"),j.attr("disabled","disabled"))})})}),a.Pinput=b}(this);